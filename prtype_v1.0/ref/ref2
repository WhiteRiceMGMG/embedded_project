2025/11/30 cortex調査

■起動処理と例外ベクタテーブル
・ROM上のプログラムを実行するタイプ
→マイコンリセットで定められたROM上のアドレスから実行．起動処理を配置しておく．
→Cortexの場合，ROM先頭に例外ベクタテーブルがあり，リセット時実行のアドレスが配置されている．
→リセット時に実行されるプログラムは例外ベクタテーブル
・RAM上に転送して実行するタイプ
→高性能マイコンに多くある．電源投入時RAMは消去されているため，ブートROM上のプログラムが実行され，
→外部記憶装置からRAMに転送される．

■例外と割り込み
特定イベント発生で割り込みし，ハンドラを実行するハードウェア機能．
C言語で書けないことが多く，アセンブリを使用したり，コンパイラ機能を用いる．

■例外ベクタテーブル
例外ハンドラの実行開始アドレスを設定したデータが例外ベクタテーブル．
cortexM0+先頭からのオフセットで順にスタックポインタ初期値，リセット，SVC，PendSV，Systickなどがある．
→PendSV,Systickなどを利用する．
CortexM0+はベクタテーブルの先頭項目はハンドラの実行アドレスではなく，リセット時設定のSP初期値になっている．

■起動処理について
先頭に16KのROMがある．工場出荷時設定のものでユーザ変更不可．例外ベクタテーブルやリセットハンドラが設定．
外部フラッシュメモリはXIP機能で通常ROM のようにアドレス空間にマップ．
外部フラッシュメモリの先頭256バイトはセカンドステージブートローダのプログラムが配置されている．
その後ろにユーザ定義例外ベクタテーブルとユーザプログラムを配置する．
ROMの例外ベクタテーブルと外部フラッシュメモリの例外ベクタテーブルは別物．
【1】ROM上のリセットハンドラ実行
リセット時，ファーストステージブートローダが実行．外部フラッシュメモリ先頭のセカンドブートステージローダをSRAM転送
【2】XIP設定
SRAMに転送されたセカンドステージブートローダではまず外部フラッシュ効率化のためXIPを設定．
【3】例外ベクタテーブルとユーザ定義リセットハンドラの実行
例外ベクタテーブルをROMのものからフラッシュメモリのユーザ定義のものに変更．
このときスタックポインタの設定を行う．続いてユーザー定義例外ベクタテーブルのリセットハンドラを実行
スタックポインタの設定やリセットハンドラは本来ハードウェア機能であるが，cortexM0+ではセカンドステージブートローダ．












